const { app, BrowserWindow, ipcMain, dialog } = require('electron');
const path = require('path');
const Pusher = require('pusher-js');

const pusher = new Pusher('ff383959a24accbacd3c', {
    cluster: 'eu'
});
const channel = pusher.subscribe('print-channel');
channel.bind('print-html', (data) => {
    // const htmlContent = `<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <title>Invoice</title> <style> @page { size: A4; margin: 1cm; } body { font-family: 'sans-serif', sans-serif; padding: 20px; color: #333; } .invoice-box { max-width: 800px; margin: auto; border: 1px solid #eee; padding: 30px; line-height: 24px; } .invoice-box table { width: 100%; line-height: inherit; text-align: left; border-collapse: collapse; } .invoice-box table td { padding: 5px; vertical-align: top; } .invoice-box table tr.heading td { background: #f0f0f0; font-weight: bold; border-bottom: 1px solid #ddd; } .invoice-box table tr.item td { border-bottom: 1px solid #eee; } .invoice-box table tr.total td { font-weight: bold; border-top: 2px solid #eee; } .title { font-size: 45px; line-height: 45px; color: #333; } .right { text-align: right; } </style> </head> <body> <div class="invoice-box"> <table> <tr> <td colspan="2"> <h1 class="title">INVOICE</h1> <p>Date: 2025-05-06<br>Invoice #: INV-001</p> </td> <td class="right"> <p><strong>Company Name</strong><br>123 Business Rd.<br>City, Country</p> </td> </tr> <tr class="heading"> <td>Bill To</td> <td colspan="2">Ship To</td> </tr> <tr class="item"> <td>Client Name<br>123 Client St.<br>Client City</td> <td colspan="2">Client Address<br>Client City</td> </tr> <tr class="heading"> <td>Description</td> <td>Qty</td> <td class="right">Price</td> </tr> <tr class="item"> <td>Product 1</td> <td>2</td> <td class="right">$20.00</td> </tr> <tr class="item"> <td>Product 2</td> <td>1</td> <td class="right">$15.00</td> </tr> <tr class="total"> <td></td> <td class="right">Total:</td> <td class="right">$55.00</td> </tr> </table> </div> </body> </html>`;       // HTML string
    // const htmlContent = `<!-- business information here -->\n<!DOCTYPE html>\n<html lang=\"en\">\n    <head>\n        <meta charset=\"UTF-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\">\n        <!-- <link rel=\"stylesheet\" href=\"style.css\"> -->\n        <title>Receipt-0191</title>\n    </head>\n    <style>\n    @import  url('https://fonts.googleapis.com/css2?family=Cairo:wght@300&display=swap');\n\n    @page  {\n        margin: 10px !important;\n    }\n\n    body {\n\n        justify-content: center;\n        padding: 0 !important;\n    }\n\n    .container {\n        padding: 0 !important\n    }\n\n    #company {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    #invoice-num {\n        margin-top: 4px;\n    }\n\n    #invoice-num>div {\n        text-align: center\n    }\n\n    #datetime {\n        margin-top: 0px;\n        display: flex;\n    }\n\n    #datetime>div {\n        /* text-align: center; */\n        padding: 0 2px;\n    }\n\n    #datetime {\n        margin: 6px 0;\n    }\n\n    .items-table {\n        margin-top: 10px;\n    }\n\n    .items-table table th,\n    .items-table table td {\n        padding: 4px;\n        text-align: center;\n    }\n\n    #totals {\n        display: flex;\n        margin-top: 10px;\n        direction: rtl;\n    }\n\n    #totals>div:nth-of-type(2) {\n        width: 100%;\n        margin-inline-start: 4px;\n        padding-inline-start: 4px;\n        border-right: 1px solid rgba(146, 146, 146, 0.152);\n    }\n\n    #totals>div>div {\n        padding: 4px;\n    }\n\n    #totals div {\n        /* white-space: nowrap; */\n    }\n\n    #totals>div:nth-of-type(1) table {\n        white-space: nowrap;\n    }\n\n    #totals>div:nth-of-type(2)>tr>td:nth-of-type(2) {\n        width: 100%;\n    }\n\n\n    #totals>div:nth-of-type(2) table tr td:nth-of-type(2) {\n        white-space: nowrap;\n    }\n\n    #total_row>td {\n        padding-top: 5px;\n    }\n\n    #total_row>td>div {\n        border-top: 1px dotted rgba(146, 146, 146, 0.152);\n        padding-top: 5px !important;\n    }\n\n    #top-table {\n        /* margin-bottom: 10px; */\n    }\n\n    table {\n        width: 100%;\n    }\n\n\n\n    #logo-wrapper {\n        width: 100%;\n        text-align: center;\n        margin: 10px auto;\n    }\n\n    #logo-wrapper img {\n        max-height: 60px;\n    }\n\n    .text-center {\n        text-align: center;\n    }\n\n    .ticket {\n        width: 98%;\n        max-width: 98%;\n        margin-left: 6px;\n        font-weight: 800;\n        color: black;\n\n    }\n    \n\n    #header-text {\n        padding-top: 10px;\n    }\n\n    body {\n        padding: 1 !important;\n        margin: 0 !important;\n        /* background-color: red !important; */\n        width: 100% !important;\n    }\n\n    #installmentTable {\n        font-size: 24px;\n        margin: 15px 0 !important;\n    }\n\n    #installment_calculations tr>td:nth-of-type(1) {\n        padding-inline-end: 10px;\n\n    }\n\n    #installmentTable td {\n        font-size: 20px;\n    }\n\n    #gurantor-receipt {\n        width: calc(100% - 100px);\n        margin: auto;\n    }\n\n    #gurantor-receipt h1 {\n        text-align: center;\n    }\n\n    #gurantor-receipt p {\n        font-size: 20px;\n    }\n\n    #commodity-sale-statement p,\n    #commodity-sale-statement div {\n        font-size: 20px;\n    }\n\n</style>\n    <body>\n          \n\n    \n        <div class=\"ticket\">\n        \t\n        \t\n        \t        \t\t<div class=\"text-box centered\">\n        \t\t    \t  \n        \t\t\t\t<img style=\"max-height: 100px; width: auto;\" src=\"https://vps.micr0smart.com/uploads/invoice_logos/1713636580_fwfw.png\" alt=\"Logo\">\n        \t\t\t        \t\t</div>\n        \t        \t\t\t  \t           <center>     <h5 style=\"text-align:center;border:1px solid black;width:400px;padding:10px\">رقم الفاتوره:0191  </h5>\n </center>         \t<div class=\"text-box\">\n        \t<!-- Logo -->\n            <p class=\"centered\">\n            \t<!-- Header text -->\n            \t            \t\t<span class=\"headings\"><p>micro smart company</p>\r\n<p>ERP system</p></span>\n\t\t\t\t\t<br/>\n\t\t\t\t \n\t\t\t\t\n\t\t\t\t<!-- business information here -->\n\t\t\t\t\t\t\t\t\t<span class=\"headings\">\n\t\t\t\t\t\tمؤسسة الذكي الصغير, micr0smart Admin\n\t\t\t\t\t</span>\n\t\t\t\t\t<br/>\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t0, خميس مشيط, عسير, 000, السعودية\n\t\t\t\t\t<br/>\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t<b>الجوال:</b> 0532060428\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\n\t\t\t\t\t\t\t\t\t<br><b>ر . ض: </b> 302094975800003\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t<!-- Title of receipt -->\n\t\t\t\t\t\t\t\t\t<br/><span class=\"sub-headings\">فاتوره ضربيه مبسطة</span>\n\t\t\t\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class=\"border-top textbox-info\">\n\t\t\t\t<p class=\"f-left\"><strong>رقم الفاتوره</strong></p>\n\t\t\t\t<p class=\"f-right\">\n\t\t\t\t\t0191\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t<div class=\"textbox-info\">\n\t\t\t\t<p class=\"f-left\"><strong>التاريخ</strong></p>\n\t\t\t\t<p class=\"f-right\">\n\t\t\t\t\t18-03-2025 16:40\n\t\t\t\t</p>\n\t\t\t</div>\n\t\t\t\n\t\t\t\n\t\t\t\t\t\t\n\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\n\t\t\t\n        \t\n        \t<!-- Waiter info -->\n\t\t\t\n\t        \n\t        <!-- customer info -->\n\t        <div class=\"textbox-info\">\n\t        \t<p style=\"vertical-align: top;\"><strong>\n\t        \t\tالعميل\n\t        \t</strong></p>\n\n\t        \t<p>\n\t        \t\t\t        \t\t\t<div class=\"bw\">\n\t\t\t\t\t\tmmmhh, <br>rytytty, <br>ابها, جده, السعودية<br><b>الجوال</b>: 58585585, 5855858585\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t        \t</p>\n\t        </div>\n\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class=\"textbox-info\">\n\t\t\t\t\t<p class=\"f-left\"><strong>\n\t\t\t\t\t\tرقم ضريبة العميل\n\t\t\t\t\t</strong></p>\n\t\t\t\t\t<p class=\"f-right\">\n\t\t\t\t\t\t\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class=\"textbox-info\">\n\t\t\t\t\t<p class=\"f-left\"><strong>\n\t\t\t\t\t\tعرض يةم الوطنى\n\t\t\t\t\t</strong></p>\n\t\t\t\t\t<p class=\"f-right\">\n\t\t\t\t\t\t0\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t            <table style=\"margin-top: 25px !important;border:1px solid black\" class=\"border-bottom width-100 table-f-12 mb-10\">\n                <thead class=\"border-bottom-dotted\">\n                    <tr>\n                        <th class=\"serial_number\">#</th>\n                        <th class=\"description\" width=\"30%\">\n                        \tProduct\n                        </th>\n                        <th class=\"quantity text-right\">\n                        \tQuantity\n                        </th>\n                                                <th class=\"unit_price text-right\">\n                        \tUnit Price\n                        </th>\n                                                <th class=\"price text-right\">Subtotal</th>\n                                            </tr>\n                </thead>\n                <tbody>\n                \t\t                    <tr>\n\t                        <td class=\"serial_number\" style=\"vertical-align: top;\">\n\t                        \t1\n\t                        </td>\n\t                        <td class=\"description\">\n\t                        \tcabel ethernet CAT6 5M SmartLink   \n\t                        \t, 15741   \t                        \t\t                        \t \n\t                        \t \n\t                        \t\t                        \t\t                            \t                            \t                        </td>\n\t                        <td class=\"quantity text-right\">1.000 Pc(s)</td>\n\t                        \t                        <td class=\"unit_price text-right\">20.000</td>\n\t                        \t                        <td class=\"price text-right\">20.000</td>\n\t                        \t                    </tr>\n\t                                                            <tr>\n                    \t<td  colspan=\"5\" >&nbsp;</td>\n                    </tr>\n                </tbody>\n            </table>\n\t\t\t\t\t\t                <div class=\"flex-box\">\n                    <p class=\"left text-right sub-headings\">\n                    \tSubtotal:\n                    </p>\n                    <p class=\"width-50 text-right sub-headings\">\n                    \tريال 20.000\n                    </p>\n                </div>\n\n                <!-- Shipping Charges -->\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t<!-- Discount -->\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t<div class=\"flex-box\">\n\t\t\t\t\t<p class=\"width-50 text-right sub-headings\">\n\t\t\t\t\t\tTotal:\n\t\t\t\t\t</p>\n\t\t\t\t\t<p class=\"width-50 text-right sub-headings\">\n\t\t\t\t\t\tريال 20.000\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<p colspan=\"2\" class=\"text-right mb-0\">\n\t\t\t\t\t<small>\n\t\t\t\t\t(عشرون)\n\t\t\t\t\t</small>\n\t\t\t\t</p>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"flex-box\">\n\t\t\t\t\t\t\t<p class=\"width-50 text-right\">نقدا (18-03-2025) </p>\n\t\t\t\t\t\t\t<p class=\"width-50 text-right\">ريال 20.000</p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\n\t\t\t\t<!-- Total Paid-->\n\t\t\t\t\t\t\t\t\t<div class=\"flex-box\">\n\t\t\t\t\t\t<p class=\"width-50 text-right\">\n\t\t\t\t\t\t\tاجمالي المدفوع\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<p class=\"width-50 text-right\">\n\t\t\t\t\t\t\tريال 20.000\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<!-- Total Due-->\n\t\t\t\t\n\t\t\t\t\t\t\t            <div class=\"border-bottom width-100\">&nbsp;</div>\n            \t            <!-- tax -->\n\t                        \n\n            \n            \n            \n            \n\t\t\t \n            <img class=\"center-block mt-5\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHsAAAB7AQMAAABuCW08AAAABlBMVEX///8nMDZ4PCBxAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAvBJREFUSImNlUGOozAQRY1YsOQG4SKWfC1YuSXuQa4STuAreOctEpsgIde8MumWeuJoBqEEPTCu+lW/MCJnnuJ+pGW0rUg0/wU4d0l5dLuCzVhAKyabbn+YCtgFIHd9U9rDeYHgluZfIE9n9vINtr7Lo7159xFkn+Q4B/lZciP0NQ5B5k9ADh7+AYS+r1ya9uHmVy6/geYeWGL3cKVfgH2dn4CoAuCzAI7baAeJW39u5jp+g9yfw9MJIgMmlvDfPl1uUm5iHaCwsGSV3AuiRdNKJw8j63nrZfG89A0QDOlLoDQs0UIdJ2AGHDGPVVCWvIBP5NJ388GfW6Z462uA3e5H2nrRVuoJ7NbIMgGSAuO+KsBrNnsAEBjAeG2LNnQUo4T+BgiMc+Z3JZ1IpE9rvJsPBLXDWgWUXpw2AAUKgHZNu0qYZokA8w7KwyiWyu9JoSbEoH0SNaAkFaCdH3i/lFwAA7fXc2sIs1t8rAGWHJIVJFwD8fI1dgsy+diKrYBW/eXu4QIsaY84iB2IsYlcV8CgTilmOdhFCzUhKL5N6va+BgYVimYGaM/w0hCzdqtpn7QvhXoDqu1K3e3wxAIOR3kcRZkB+lwFFO8zCWi9eNUl6A2i2Q91bwWwS/ZdLoAJ8AOMVWtNp6kBji43pKh5UezQ3R+AqKBU/2+wF6dQ/furYagZHTcDDsxtKqD02NXJ6HaVgdm5NWr1QWfBG1CRAT2i6YW6gbEFsOTMfKwAhM3FMsTGBao/O24PR6J3vzw5v4NDH8eYVzoamOhuTbza8SNAsRKhtuWo71UJMZU27huQ1xArrhECA+Q+GkDoRPvjA9AZK6k0jI7DhjLLlyfnGlBtNTPZ9GNxgUHjEExYylADUrxf5kx8fbTcXU2CUjXw/RVLJZULlBmUipbaH3Ug4VqidRHbruoQPgibcXWA2KJmYVC5ssvwsAC6lm9DHUjQ2BZAk0roajg2bKKpAh203unY7yOqFLCNbO+0pRot1F/gDw7fJxxXrQHZAAAAAElFTkSuQmCC\">\n\t\t\t\n            \t\n\t\t\t\t\t\t\t<br/>\n\t\t\t\t<img class=\"center-block\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAAeAQMAAADKJdgfAAAABlBMVEX///8nMDZ4PCBxAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAEhJREFUGJVj+Mx/+PB5/s/nDQ7/+WBvfIBhlI/KJwrw89gYIPMl56QVoPDXpG1A5kv3pKGol+2xQ9Xfw4bGR1XPb2/zhziXAQCq+K/gKFGtEwAAAABJRU5ErkJggg==\">\n\t\t\t           \n              \n\t\t\t\t\t\t\n        </div>\n        <!-- <button id=\"btnPrint\" class=\"hidden-print\">Print</button>\n        <script src=\"script.js\"></script> -->\n         \n    </body>\n    <script>\n       setTimeout(function() {\n        window.print(); \n      }, 2000);\n    window.onload = function() {\n      window.print(); \n     \n    };\n    function afterPrint() {\n      console.log(\"Print completed\");\n      \n      // Display second dialog or perform additional actions\n      setTimeout(function() {\n        window.print(); \n      }, 2000); // Display after 2000 milliseconds (2 seconds)\n    }\n\n    // Register the onafterprint event handler\n   // window.addEventListener(\"afterprint\", afterPrint, false);\n \n  </script>\n</html>\n    \n         \n<style type=\"text/css\">\n.f-8 {\n\tfont-size: 8px !important;\n}\n@media  print {\n\t* {\n    \tfont-size: 12px;\n    \tfont-family: 'Times New Roman';\n    \tword-break: break-all;\n\t}\n\t.f-8 {\n\t\tfont-size: 8px !important;\n\t}\n\t\n.headings{\n\tfont-size: 16px;\n\tfont-weight: 700;\n\ttext-transform: uppercase;\n\twhite-space: nowrap;\n}\n\n.sub-headings{\n\tfont-size: 15px !important;\n\tfont-weight: 700 !important;\n}\n\n.border-top{\n    border-top: 1px solid #242424;\n}\n.border-bottom{\n\tborder-bottom: 1px solid #242424;\n}\n\n.border-bottom-dotted{\n\tborder-bottom: 1px dotted darkgray;\n}\n\ntd.serial_number, th.serial_number{\n\twidth: 5%;\n    max-width: 5%;\n}\n\ntd.description,\nth.description {\n    width: 35%;\n    max-width: 35%;\n}\n\ntd.quantity,\nth.quantity {\n    width: 15%;\n    max-width: 15%;\n    word-break: break-all;\n}\ntd.unit_price, th.unit_price{\n\twidth: 25%;\n    max-width: 25%;\n    word-break: break-all;\n}\n\ntd.price,\nth.price {\n    width: 20%;\n    max-width: 20%;\n    word-break: break-all;\n}\n\n.centered {\n    text-align: center;\n    align-content: center;\n}\n\n.ticket {\n    width: 100%;\n    max-width: 100%;\n}\n\nimg {\n    max-width: inherit;\n    width: auto;\n}\n\n    .hidden-print,\n    .hidden-print * {\n        display: none !important;\n    }\n}\n.table-info {\n\twidth: 100%;\n}\n.table-info tr:first-child td, .table-info tr:first-child th {\n\tpadding-top: 8px;\n}\n.table-info th {\n\ttext-align: left;\n}\n.table-info td {\n\ttext-align: right;\n}\n.logo {\n\tfloat: left;\n\twidth:35%;\n\tpadding: 10px;\n}\n\n.text-with-image {\n\tfloat: left;\n\twidth:65%;\n}\n.text-box {\n\twidth: 100%;\n\theight: auto;\n}\n\n.textbox-info {\n\tclear: both;\n}\n.textbox-info p {\n\tmargin-bottom: 0px\n}\n.flex-box {\n\tdisplay: flex;\n\twidth: 100%;\n}\n.flex-box p {\n\twidth: 50%;\n\tmargin-bottom: 0px;\n\twhite-space: nowrap;\n}\n\n.table-f-12 th, .table-f-12 td {\n\tfont-size: 12px;\n\tword-break: break-word;\n}\n\n.bw {\n\tword-break: break-word;\n}\n</style> \n`;
    const htmlContent = `<!-- business information here --> <!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <!-- <link rel="stylesheet" href="style.css"> --> <link rel="stylesheet" href="https://vps.micr0smart.com/css/vendor.css?v=488"> <link rel="stylesheet" href="https://vps.micr0smart.com/css/rtl.css?v=488"> <link rel="stylesheet" href="https://vps.micr0smart.com/css/app.css?v=488"> <title>Receipt-0191</title> </head> <style> @import  url('https://fonts.googleapis.com/css2?family=Cairo:wght@300&display=swap'); @page  { margin: 10px !important; } body { justify-content: center; padding: 0 !important; } .container { padding: 0 !important } #company { display: flex; justify-content: center; align-items: center; } #invoice-num { margin-top: 4px; } #invoice-num>div { text-align: center } #datetime { margin-top: 0px; display: flex; } #datetime>div { padding: 0 2px; } #datetime { margin: 6px 0; } .items-table { margin-top: 10px; } .items-table table th, .items-table table td { padding: 4px; text-align: center; } #totals { display: flex; margin-top: 10px; direction: rtl; } #totals>div:nth-of-type(2) { width: 100%; margin-inline-start: 4px; padding-inline-start: 4px; border-right: 1px solid rgba(146, 146, 146, 0.152); } #totals>div>div { padding: 4px; } #totals div { } #totals>div:nth-of-type(1) table { white-space: nowrap; } #totals>div:nth-of-type(2)>tr>td:nth-of-type(2) { width: 100%; } #totals>div:nth-of-type(2) table tr td:nth-of-type(2) { white-space: nowrap; } #total_row>td { padding-top: 5px; } #total_row>td>div { border-top: 1px dotted rgba(146, 146, 146, 0.152); padding-top: 5px !important; } #top-table { } table { width: 100%; } #logo-wrapper { width: 100%; text-align: center; margin: 10px auto; } #logo-wrapper img { max-height: 60px; } .text-center { text-align: center; } .ticket { width: 98%; max-width: 98%; margin-left: 6px; font-weight: 800; color: black; } #header-text { padding-top: 10px; } body { padding: 1 !important; margin: 0 !important; width: 100% !important; } #installmentTable { font-size: 24px; margin: 15px 0 !important; } #installment_calculations tr>td:nth-of-type(1) { padding-inline-end: 10px; } #installmentTable td { font-size: 20px; } #gurantor-receipt { width: calc(100% - 100px); margin: auto; } #gurantor-receipt h1 { text-align: center; } #gurantor-receipt p { font-size: 20px; } #commodity-sale-statement p, #commodity-sale-statement div { font-size: 20px; } </style> <body> <div class="ticket"> <div class="text-box centered"> <img style="max-height: 100px; width: auto;" src="https://vps.micr0smart.com/uploads/invoice_logos/1713636580_fwfw.png" alt="Logo"> </div> <center> <h5 style="text-align:center;border:1px solid black;width:400px;padding:10px">رقم الفاتوره:0191</h5> </center> <div class="text-box"> <!-- Logo --> <p class="centered"> <!-- Header text --> <span class="headings"><p>micro smart company</p> <p>ERP system</p></span> <br/> <!-- business information here --> <span class="headings"> مؤسسة الذكي الصغير, micr0smart Admin </span> <br/> 0, خميس مشيط, عسير, 000, السعودية <br/> <b>الجوال:</b> 0532060428 <br><b>ر . ض: </b> 302094975800003 <!-- Title of receipt --> <br/><span class="sub-headings">فاتوره ضربيه مبسطة</span> </p> </div> <div class="border-top textbox-info"> <p class="f-left"><strong>رقم الفاتوره</strong></p> <p class="f-right"> 0191 </p> </div> <div class="textbox-info"> <p class="f-left"><strong>التاريخ</strong></p> <p class="f-right"> 18-03-2025 16:40 </p> </div> <!-- Waiter info --> <!-- customer info --> <div class="textbox-info"> <p style="vertical-align: top;"><strong> العميل </strong></p> <p> <div class="bw"> mmmhh, <br>rytytty, <br>ابها, جده, السعودية<br><b>الجوال</b>: 58585585, 5855858585 </div> </p> </div> <div class="textbox-info"> <p class="f-left"><strong> رقم ضريبة العميل </strong></p> <p class="f-right"> </p> </div> <div class="textbox-info"> <p class="f-left"><strong> عرض يةم الوطنى </strong></p> <p class="f-right"> 0 </p> </div> <table style="margin-top: 25px !important;border:1px solid black" class="border-bottom width-100 table-f-12 mb-10"> <thead class="border-bottom-dotted"> <tr> <th class="serial_number">#</th> <th class="description" width="30%"> Product </th> <th class="quantity text-right"> Quantity </th> <th class="unit_price text-right"> Unit Price </th> <th class="price text-right">Subtotal</th> </tr> </thead> <tbody> <tr> <td class="serial_number" style="vertical-align: top;"> 1 </td> <td class="description"> cabel ethernet CAT6 5M SmartLink , 15741 </td> <td class="quantity text-right">1.000 Pc(s)</td> <td class="unit_price text-right">20.000</td> <td class="price text-right">20.000</td> </tr> <tr> <td colspan="5">&nbsp;</td> </tr> </tbody> </table> <div class="flex-box"> <p class="left text-right sub-headings"> Subtotal: </p> <p class="width-50 text-right sub-headings"> ريال 20.000 </p> </div> <!-- Shipping Charges --> <!-- Discount --> <div class="flex-box"> <p class="width-50 text-right sub-headings"> Total: </p> <p class="width-50 text-right sub-headings"> ريال 20.000 </p> </div> <p colspan="2" class="text-right mb-0"> <small> (عشرون) </small> </p> <div class="flex-box"> <p class="width-50 text-right">نقدا (18-03-2025) </p> <p class="width-50 text-right">ريال 20.000</p> </div> <!-- Total Paid--> <div class="flex-box"> <p class="width-50 text-right"> اجمالي المدفوع </p> <p class="width-50 text-right"> ريال 20.000 </p> </div> <!-- Total Due--> </div> </body> </html>`;
    const printerName = data.printer;    // Exact printer name
    sendToPrinter(htmlContent, printerName);
});

function sendToPrinter(htmlContent, printerName) {
    // console.log(htmlContent, printerName);

    const printWindow = new BrowserWindow({
        width: 800,
        height: 600,
        show: false,
        webPreferences: {
            nodeIntegration: true,
            contextIsolation: false,
        }
    });

    printWindow.loadURL('data:text/html;charset=utf-8,' + encodeURIComponent(htmlContent));

    printWindow.webContents.on('did-finish-load', () => {
    	const printOptions = {
	        silent: true, 
	        printBackground: true,
		    deviceName: printerName,
		    pageSize: {
				width: 80000,
				height: 1000000
	        },
			margins: {
			  	marginType: 'none'
			}
        };

	    printWindow.webContents.print(printOptions, (success, failureReason) => {
            if (!success) {
                dialog.showErrorBox('Print Error', 'Print failed: ' + failureReason + ' - ' + printerName);
                console.log('error in print');
            }
            printWindow.close();
            console.log('printed successfully');
        });
    });
}


function createWindow() {
    const win = new BrowserWindow({
        width: 800,
        height: 600,
        webPreferences: {
            preload: path.join(__dirname, 'preload.js')
        }
    });

    win.loadFile('index.html');

    // Handle request for printers
    ipcMain.handle('get-printers', () => {
        return win.webContents.getPrintersAsync(); // returns a promise
    });
}

app.whenReady().then(createWindow);
